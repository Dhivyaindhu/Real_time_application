# -*- coding: utf-8 -*-
"""Untitled144.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1UrbXQ4_5b1_v5wMj0DB-geKg6Dal9eyu
"""

import streamlit as st
import requests
from PIL import Image
import io
import os

# Load OCR API Key from secrets
OCR_API_KEY = st.secrets["ocr"]["api_key"]

# Streamlit UI
st.title("Bill OCR Extractor")
st.write("Upload your bill images, and we'll extract the text.")

# File Uploader for Multiple Files
uploaded_files = st.file_uploader("Upload Bills", type=["png", "jpg", "jpeg"], accept_multiple_files=True)

# Function to Extract Text Using OCR API
def extract_text(image):
    api_url = "https://api.ocrservice.com/parse"  # Replace with actual OCR API URL
    headers = {"Authorization": f"Bearer {OCR_API_KEY}"}

    # Convert image to bytes
    img_bytes = io.BytesIO()
    image.save(img_bytes, format=image.format)
    img_bytes = img_bytes.getvalue()

    # Send Request
    response = requests.post(api_url, files={"file": img_bytes}, headers=headers)

    if response.status_code == 200:
        return response.json().get("text", "No text found")
    else:
        return f"Error: {response.text}"

# Process Each Uploaded File
if uploaded_files:
    for file in uploaded_files:
        # Open image
        image = Image.open(file)

        # Display image
        st.image(image, caption="Uploaded Bill", use_container_width=True)

        # Extract text
        extracted_text = extract_text(image)
        st.text_area("Extracted Text", extracted_text, height=200)

# Run Streamlit App
if __name__ == "__main__":
    st.run()